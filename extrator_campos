// EXTRATOR COMPLETO DE ESTRUTURA FRONT-END
// Execute no console do navegador (F12)

(function() {
    console.clear();
    console.log('ğŸ” Iniciando extraÃ§Ã£o completa do front-end...\n');
    
    const report = {
        timestamp: new Date().toISOString(),
        url: window.location.href,
        title: document.title,
        stats: {
            totalElements: 0,
            totalClasses: 0,
            totalIds: 0,
            uniqueClasses: new Set(),
            uniqueIds: new Set(),
            elementTypes: {}
        },
        structure: [],
        classList: {},
        idList: {},
        customAttributes: {}
    };

    // FunÃ§Ã£o para extrair todos os atributos custom (data-*, aria-*, etc)
    function getCustomAttributes(element) {
        const attrs = {};
        for (let attr of element.attributes) {
            if (attr.name.startsWith('data-') || 
                attr.name.startsWith('aria-') || 
                attr.name.startsWith('ng-') ||
                attr.name.startsWith('v-') ||
                attr.name.startsWith('x-')) {
                attrs[attr.name] = attr.value;
            }
        }
        return attrs;
    }

    // FunÃ§Ã£o para obter o seletor Ãºnico do elemento
    function getUniqueSelector(element) {
        if (element.id) return `#${element.id}`;
        
        let path = [];
        while (element && element.nodeType === Node.ELEMENT_NODE) {
            let selector = element.nodeName.toLowerCase();
            if (element.className) {
                selector += '.' + Array.from(element.classList).join('.');
            }
            path.unshift(selector);
            element = element.parentNode;
            if (path.length > 5) break; // Limitar profundidade
        }
        return path.join(' > ');
    }

    // FunÃ§Ã£o recursiva para mapear a Ã¡rvore DOM
    function mapElement(element, depth = 0) {
        if (!element || element.nodeType !== Node.ELEMENT_NODE) return null;

        const tagName = element.tagName.toLowerCase();
        const classes = Array.from(element.classList);
        const id = element.id || null;
        const customAttrs = getCustomAttributes(element);

        // EstatÃ­sticas
        report.stats.totalElements++;
        report.stats.elementTypes[tagName] = (report.stats.elementTypes[tagName] || 0) + 1;
        
        if (classes.length > 0) {
            report.stats.totalClasses += classes.length;
            classes.forEach(cls => report.stats.uniqueClasses.add(cls));
        }
        
        if (id) {
            report.stats.totalIds++;
            report.stats.uniqueIds.add(id);
        }

        // Catalogar classes por elemento
        if (classes.length > 0) {
            classes.forEach(cls => {
                if (!report.classList[cls]) {
                    report.classList[cls] = [];
                }
                report.classList[cls].push({
                    tag: tagName,
                    selector: getUniqueSelector(element),
                    depth: depth
                });
            });
        }

        // Catalogar IDs
        if (id) {
            report.idList[id] = {
                tag: tagName,
                classes: classes,
                selector: getUniqueSelector(element)
            };
        }

        // Catalogar atributos custom
        if (Object.keys(customAttrs).length > 0) {
            Object.keys(customAttrs).forEach(attr => {
                if (!report.customAttributes[attr]) {
                    report.customAttributes[attr] = [];
                }
                report.customAttributes[attr].push({
                    tag: tagName,
                    value: customAttrs[attr],
                    selector: getUniqueSelector(element)
                });
            });
        }

        // Criar nÃ³ da estrutura
        const node = {
            tag: tagName,
            classes: classes,
            id: id,
            depth: depth,
            selector: getUniqueSelector(element),
            customAttributes: customAttrs,
            children: []
        };

        // Processar filhos
        Array.from(element.children).forEach(child => {
            const childNode = mapElement(child, depth + 1);
            if (childNode) {
                node.children.push(childNode);
            }
        });

        return node;
    }

    // Iniciar extraÃ§Ã£o
    const rootNode = mapElement(document.body);
    report.structure.push(rootNode);

    // Converter Sets para Arrays
    report.stats.uniqueClasses = Array.from(report.stats.uniqueClasses).sort();
    report.stats.uniqueIds = Array.from(report.stats.uniqueIds).sort();

    // ============== SAÃDA DOS RESULTADOS ==============
    
    console.log('ğŸ“Š ESTATÃSTICAS GERAIS');
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    console.log(`Total de elementos: ${report.stats.totalElements}`);
    console.log(`Total de classes (duplicadas): ${report.stats.totalClasses}`);
    console.log(`Classes Ãºnicas: ${report.stats.uniqueClasses.length}`);
    console.log(`IDs Ãºnicos: ${report.stats.uniqueIds.length}`);
    console.log('\n');

    console.log('ğŸ“¦ ELEMENTOS POR TIPO');
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    console.table(report.stats.elementTypes);
    console.log('\n');

    console.log('ğŸ¨ TODAS AS CLASSES ÃšNICAS');
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    report.stats.uniqueClasses.forEach(cls => {
        console.log(`  â€¢ ${cls} (usado ${report.classList[cls].length}x)`);
    });
    console.log('\n');

    console.log('ğŸ†” TODOS OS IDs');
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    report.stats.uniqueIds.forEach(id => {
        const info = report.idList[id];
        console.log(`  â€¢ #${id} â†’ <${info.tag}> ${info.classes.length > 0 ? `[${info.classes.join(', ')}]` : ''}`);
    });
    console.log('\n');

    console.log('ğŸ”§ ATRIBUTOS CUSTOMIZADOS');
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    Object.keys(report.customAttributes).forEach(attr => {
        console.log(`  â€¢ ${attr} (usado ${report.customAttributes[attr].length}x)`);
    });
    console.log('\n');

    // ============== GERAR ARQUIVOS PARA DOWNLOAD ==============
    
    // 1. RelatÃ³rio completo JSON
    const jsonBlob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
    const jsonUrl = URL.createObjectURL(jsonBlob);
    
    // 2. Lista de classes em texto
    const classesText = report.stats.uniqueClasses.map(cls => {
        const usage = report.classList[cls];
        return `${cls}\n  Usado em: ${usage.map(u => u.tag).join(', ')}\n  FrequÃªncia: ${usage.length}x\n`;
    }).join('\n');
    const classesBlob = new Blob([classesText], { type: 'text/plain' });
    const classesUrl = URL.createObjectURL(classesBlob);
    
    // 3. Estrutura HTML simplificada
    function generateHTMLStructure(node, indent = 0) {
        const spaces = '  '.repeat(indent);
        let html = `${spaces}<${node.tag}`;
        if (node.id) html += ` id="${node.id}"`;
        if (node.classes.length > 0) html += ` class="${node.classes.join(' ')}"`;
        html += '>\n';
        
        node.children.forEach(child => {
            html += generateHTMLStructure(child, indent + 1);
        });
        
        html += `${spaces}</${node.tag}>\n`;
        return html;
    }
    const htmlStructure = generateHTMLStructure(rootNode);
    const htmlBlob = new Blob([htmlStructure], { type: 'text/html' });
    const htmlUrl = URL.createObjectURL(htmlBlob);
    
    // 4. CSS com todas as classes (template)
    const cssTemplate = report.stats.uniqueClasses.map(cls => {
        return `.${cls} {\n  /* Usado ${report.classList[cls].length}x */\n}\n`;
    }).join('\n');
    const cssBlob = new Blob([cssTemplate], { type: 'text/css' });
    const cssUrl = URL.createObjectURL(cssBlob);

    // ============== CRIAR LINKS DE DOWNLOAD ==============
    
    console.log('ğŸ’¾ ARQUIVOS GERADOS - CLIQUE PARA BAIXAR');
    console.log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”');
    
    console.log('%cğŸ“¥ BAIXAR RELATÃ“RIO COMPLETO (JSON)', 'color: #00ff00; font-weight: bold; font-size: 14px;');
    console.log(jsonUrl);
    
    console.log('\n%cğŸ“¥ BAIXAR LISTA DE CLASSES (TXT)', 'color: #00ff00; font-weight: bold; font-size: 14px;');
    console.log(classesUrl);
    
    console.log('\n%cğŸ“¥ BAIXAR ESTRUTURA HTML', 'color: #00ff00; font-weight: bold; font-size: 14px;');
    console.log(htmlUrl);
    
    console.log('\n%cğŸ“¥ BAIXAR TEMPLATE CSS', 'color: #00ff00; font-weight: bold; font-size: 14px;');
    console.log(cssUrl);

    // Criar interface visual para download
    const downloadPanel = document.createElement('div');
    downloadPanel.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        background: #1e1e1e;
        color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        z-index: 999999;
        font-family: monospace;
        max-width: 400px;
    `;
    
    downloadPanel.innerHTML = `
        <h3 style="margin-top:0; color: #00ff00;">ğŸ” ExtraÃ§Ã£o Completa</h3>
        <p style="font-size: 12px; margin: 10px 0;">
            <strong>${report.stats.totalElements}</strong> elementos<br>
            <strong>${report.stats.uniqueClasses.length}</strong> classes Ãºnicas<br>
            <strong>${report.stats.uniqueIds.length}</strong> IDs
        </p>
        <div style="display: flex; flex-direction: column; gap: 10px; margin-top: 15px;">
            <a href="${jsonUrl}" download="frontend-report.json" style="padding: 10px; background: #00ff00; color: #000; text-decoration: none; border-radius: 4px; text-align: center; font-weight: bold;">
                ğŸ“„ RelatÃ³rio JSON
            </a>
            <a href="${classesUrl}" download="classes-list.txt" style="padding: 10px; background: #0088ff; color: #fff; text-decoration: none; border-radius: 4px; text-align: center; font-weight: bold;">
                ğŸ¨ Lista de Classes
            </a>
            <a href="${htmlUrl}" download="structure.html" style="padding: 10px; background: #ff6600; color: #fff; text-decoration: none; border-radius: 4px; text-align: center; font-weight: bold;">
                ğŸ“¦ Estrutura HTML
            </a>
            <a href="${cssUrl}" download="template.css" style="padding: 10px; background: #ff00ff; color: #fff; text-decoration: none; border-radius: 4px; text-align: center; font-weight: bold;">
                ğŸ’… Template CSS
            </a>
        </div>
        <button onclick="this.parentElement.remove()" style="margin-top: 15px; padding: 8px; width: 100%; background: #ff4444; color: #fff; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">
            âœ– Fechar
        </button>
    `;
    
    document.body.appendChild(downloadPanel);

    console.log('\nâœ… ExtraÃ§Ã£o concluÃ­da com sucesso!');
    console.log('ğŸ’¡ Dica: Verifique o painel no canto superior direito da pÃ¡gina');
    
    // Retornar o objeto report para anÃ¡lise programÃ¡tica
    window.frontendReport = report;
    console.log('\nğŸ”— Acesse o relatÃ³rio via: window.frontendReport');
    
    return report;
})();
